= Virtual Satellite 4 Core: User Manual
:imagesdir: images
:title-logo-image: images/title/VirtualSatellite_Modelling_4k.jpg
:toc:
:experimental:  

[quote, Philipp M. Fischer]
It has been a long way to get here and it will be an even harder way to go on. Thanks to everyone who contributed so far.

:sectnums:

== Getting Started

Learn about basic requirements of Virtual Satellite, how it is installed and begin your first modeling. It probably takes less than 15 minutes until you have your first item modeled.  

=== System Requirements 

Virtual Satellite is based on Java and Eclipse Technology. It currently supports the following operating system configurations

. Windows 7 64bit with Java 8 runtime environment
. Linux 64 bit with Java 8 runtime environment

[WARNING] 
.Linux compilation issues
==== 
Some dependencies to C and C++ libraries are build on a Suse Linux Enterprise Distribution (SLED). A re-compilation when using other distributions is probably needed. This concerns e.g. the visualization functionality based on the Visualization Toolkit (VTK).
====

=== Installation

Installing Virtual Satellite is as easy as possible. Provided that a Java Runtime environment is installed to your system. Follow the steps below to install Virtual Satellite on a windows system: 

NOTE: Installation steps on linux are very similar.

{counter2:step:0}
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Download the Virtual Satellite zip-file from the GitHub releases section.
|image:chapterInstallation/DownloadGitHubRelease.png[Download]

|{counter:step}.
|Store the zip file to the folder of your choice (e.g.: `C:\VirtualSatellite\`) and unzip it here.
|image:chapterInstallation/UnZip.png[Unzip]

|{counter:step}.
|Dive into the unzipped sub-folder and Execute the `VirSat4_Core.exe` file.
|image:chapterInstallation/Execute.png[Execute]

|{counter:step}.
|Once Virtual Satellite is started it should appear as shown in the image. Now press the link btn:[Start modeling now!].
|image:chapterInstallation/VirtualSatelliteStarted.png[Started]

|===

Done. You installed and successfully started Virtual Satellite.

=== First Steps

Now when you successfully installed Virtual Satellite to your computer it is about time to get started using it. This chapter provides some first steps to learn some basic functionality to work with this software.

NOTE: In this example we work locally on your computer, there is no need for a subversion service or similar. 

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Dive into the folder where you installed Virtual Satellite and and Execute the `VirSat4_Core.exe` file.
|image:chapterFirstSteps/Execute.png[Execute]

|{counter:step}.
|The OSGI Console will open up and a Splash screen will be displayed showing the start-up progress.

NOTE: Details to the Equinox OSGI Console will be explained later in chapter <<Equinox OSGI Console>>.
|image:chapterFirstSteps/SplashAndOSGI.png[Splash Screen and OSGI Console]

|{counter:step}.
|During start-up, Virtual Satellite will ask for the workspace folder. Choose a folder you prefer or stick with the default one. This workspace folder is used to store the files of your project locally. 

NOTE: You can also choose different folders for different projects. And you can change between these folders later.
|image:chapterFirstSteps/ChooseWorkspace.png[Execute]

|{counter:step}.
|After a while you will see the _Welcome Screen_ of Virtual Satellite, Press the link btn:[Start Modelling now!]. This will open the Virtual Satellite _perspective_. 

NOTE: In case you don't see the _Welcome Screen_ as shown in the image, it is possible that you already started Virtual Satellite and closed it. To open the _Welcome Screen_ again open the menu:Help[Welcome].
|image:chapterFirstSteps/VirtualSatelliteStarted.png[Started]

|{counter:step}.
|The three important _views_ of the _perspective_ are:

. The _Navigator_ to the left (blue dashed box).
. The _Editing_ area in the middle which is currently empty (green dashed box).
. the _Concept Palette_ to the right (orange dashed box).

NOTE: In case _views_ get lost, you can always reset the _perspective_ by right-click image:chapterFirstSteps/BtnCorePerspective.png[Icon Core Perspective] then menu:Context[Reset] 
|image:chapterFirstSteps/Perspective.png[Perspective]

|{counter:step}.
|Open the dialog for creating a new project by pressing the marked icon in the _navigator_. 

NOTE: Alternatively you can use the _new_ dialog from the main-menu following menu:File[New > Other...] or kbd:[CTRL+N]. Then from the _new_ dialog select menu:VirSat[VirSat Project] and press btn:[Next>].
|image:chapterFirstSteps/BtnOpenProject.png[Open project]

|{counter:step}.
|In the _New Project_ dialog type in a name for your project (e.g. `MySatellite`). Press btn:[Finish] to create the new project. 
|image:chapterFirstSteps/NewProjectDialog.png[New Project Dialog]

|{counter:step}.
|Now open the _Repository_ from the _Navigator_ view by double-clicking menu:MySatellite[Repository]. 
|image:chapterFirstSteps/OpenRepository.png[Open Repository]

|{counter:step}.
|The _Repository Editor_ will open in the _Editing_ area. Scroll down to the _table Section for: Active Concepts_. Here click on btn:[Add from Registry]. 
|image:chapterFirstSteps/RepositoryEditor.png[Repository Editor]

|{counter:step}.
|Select the following two _Concepts_ in the dialog by ticking the check-box. Then press btn:[OK] to activate the _Concepts_. 

. The _Concept_ for Product Structures _de.dlr.sc.virsat.model.extension.ps_.
. The _Concept_ for Design Maturity _de.dlr.sc.virsat.model.extension.maturity_.

NOTE: The numbers in the brackets after the _Concept_ name denote the version of the _Concept_.

NOTE: _Concepts_ can require other concepts. If you select a concept, all its required concepts are also selected.

|image:chapterFirstSteps/ConceptDialog.png[Concept Dialog]

|{counter:step}.
|Go back to the _Navigator_ view and right-click on _Repository_. Now select menu:Context[Product Structures > Add ProductTree]. 
|image:chapterFirstSteps/CreateProductTree.png[Create Product Tree]

|{counter:step}.
|Now right-click on the newly generated item _PT: ProductTree_. Now select menu:Context[Product Structures > Add ProductTreeDomain]. 
|image:chapterFirstSteps/ProductTreeDomain.png[Create Product Tree Domain]

|{counter:step}.
|Double-click on the newly generated _PTD: ProductTreeDomain_ item to open it in the _Editor_. In the Editor change the name to e.g. `AOCS` (Attitude and Orbit Control System) as shown in the image.

NOTE: The ribbon tab of the _Editor_ changes from "PTD: ..." to "+*PTD: ...". The extra *+ shows that there are unsaved changes.

TIP: Save your work frequently since most changes are kept in memory and not on your hard-drive. You can easily save your work by pressing kbd:[CTRL+S] from within the current _Editor_ or by menu:File[Save]. You should use kbd:[CTRL+SHIFT+S] or menuFile:[Save All] to save all _Editors_ and chnages.
|image:chapterFirstSteps/ProductTreeDomainEditor.png[Product Tree Domain Editor]

|{counter:step}.
|Create an _Element Definition_ in the _PTD: AOCS_ similar as in the steps before. Name it `RW` (Reaction Wheel).

TIP: You can also use the _Concept Pallete_ and *drag* the _Element Definition_ item to the _PTD: AOCS_ in the _Navigator_ *and drop* it.
|image:chapterFirstSteps/AddedElementDefinition.png[Added Element Definition]

|{counter:step}.
|After modeling the _Structural Element Instances_ it is now time to add some design information. Go back to the _Navigator_ view and right-click on the newly created _ED: RW_. Select menu:Context[Design Maturity > Add Maturity]. After this double-click on the _ED: RW_ to open it in the _Editor_.

TIP: The whole _Conceptual Data Model_ (CDM) is based on _Structural Elements_ and _Category Definitions_. At runtime the _CDM_ is used to create the _System Model_. Now _Structural Element Instances_ and _Category Assignments_ are instantiated.   
|image:chapterFirstSteps/AddMaturity.png[Add Maturity]

|{counter:step}.
|In the editor scroll-down to _Section for: Maturity_. Click into the upper table to change the level _Enum Property_ to `READY_TO_BE_USED=1` and the trl _Enum Property_ to `TRL_9=9`.  

NOTE: Opening the _Editor_ on the _Structural Element Instance_ gives access to all _Category Assignments_. Double-clicking an individual _Category Assignment_ in the _Navigator_ opens and individual _Editor_ for it. You can also open this individual _Editor_ by selecting the _Category Assignment_ in the table in the _Editor_ and press btn:[Drill-Down].
|image:chapterFirstSteps/EditorMaturity.png[Maturity Editor]

|===

Well Done. You successfully created your very first model using Virtual Satellite. With this first hands-on experience you learned the first important steps to use this software. Continue reading the next chapters to learn how to use it in real system engineering scenarios. 

== Setting up the infrastructure

TBD

=== Architecture Overview

TBD

=== Sharing and committing a new project

Virtual Satellite uses SVN for collaborative work. In order to work on a project with other people, you need to store it in an SVN repository.
First of all, you need to install an SVN connector.

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open menu:Window[Preferences].
|image:chapterSettingUpInfrastructure/Preferences.png[Preferences]

|{counter:step}.
|Select menu:Team[SVN], open the tab _SVN Connector_ and press btn:[Get Connectors...]
|image:chapterSettingUpInfrastructure/GetSvnConnectors.png[Get SVN Connectors]

|{counter:step}.
|Choose one of the connectors in the list, press btn:[Finish] and follow the installation steps - accept the user agreement, agree to the unsigned content and restart Virtual Satellite.
|image:chapterSettingUpInfrastructure/Connectors.png[Connectors]

|===

After the restart you can share your project.

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open the _Project Explorer_ tab in the _Navigator_ view. 
|image:chapterSettingUpInfrastructure/ProjectExplorer.png[Opening Project Explorer]

|{counter:step}.
|In the context menu of your project select menu:Context[Team > Share Project...].
|image:chapterSettingUpInfrastructure/ShareProject.png[Share Project]

|{counter:step}.
|In the _Share Project Wizard_ enter the desired URL in your SVN repository, provide credentials for SVN and press btn:[Finish].

NOTE: If the specified SVN location does not exist, you will get a notification "Location information has been specified incorrectly. Keep location anyway?". Answering btn:[OK] creates the location.

|image:chapterSettingUpInfrastructure/ShareProjectDialog.png[Share Project Dialog]

|{counter:step}.
|Next you will see a commit dialog where you can optionally write a commit message. Press btn:[OK] to commit your project to SVN.
|image:chapterSettingUpInfrastructure/Commit.png[Commit Dialog]

|===

Now your project is connected to an SVN repository, you can *Commit* and *Update* it (see <<Updating and committing a shared project>>), and you can give its URL to your collaborators.

=== Loading a project from SVN

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Click on the btn:[Open Perspective] button in the top right corner and open the _SVN Repository Exploring_ perspective. 
|image:chapterSettingUpInfrastructure/SvnPerspective.png[SVN Perspective]

|{counter:step}.
|In the _SVN Repositories_ view click btn:[New Repository Location] and enter the URL of your project and your SVN credentials.
|image:chapterSettingUpInfrastructure/AddSvnRepository.png[Add SVN Repository]

|{counter:step}.
|Press menu:Context[Check Out] on your repository.

NOTE: You need to check out a folder that directly contains *data* folder. You may need to expand some intermediate folders to get there.

|image:chapterSettingUpInfrastructure/Checkout.png[Check Out]

|{counter:step}.
|Go back to the _VirSat - Core_ perspective, and in the _Navigator_ view you will see a project that you just checked out.
|image:chapterSettingUpInfrastructure/CheckoutDone.png[Checked out Project]

|===


=== Updating and committing a shared project

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|To get the most recent changes from the repository, press menu:Context[Update Project from Repository] in _Navigator_. To upload your changes to the repository, press menu:Context[Commit Project to Repository] and optionally provide a commit message in the dialog that pops up.

TIP: There are also icons for committing and updating in the icon bar of the _Navigator_.

NOTE: Whenever you commit and update, you do it for the whole project.

|image:chapterSettingUpInfrastructure/Committing.png[Committing and Updating]

|===

== Modeling with Virtual Satellite

Learn here about the out of the box available modeling capabilities supported by Virtual Satellite.
In this chapter you will learn about concepts, how to work with them, how to interact with the data model,
and which default concepts are delivered to you by the Core. 

=== General modeling

Virtual Satellite supplies a core modeling language. 
Amongst other advanced capabilities, it allows storing various peripheral information such as user rights and unit management.
The modeling language can be extended by _concepts_, which represent specific engineering processes or knowledge domains.

NOTE: For example activating the _de.dlr.sc.virsat.model.extension.ps_ concept extends the modeling language by allowing modeling of complex product structures including product trees and product configurations.

==== User Rights Management

Having multiple users manipulate the data model concurrently may lead to merge conflicts.
To avoid such issues, Virtual Satellite provides a rights management system.
It defines which user is allowed to manipulate a certain model element.
The association between a user and the modifiable elements is called a _Discipline_.
Then only users logged in with that specified user name are allowed to modify those elements.
A _Discipline_ has two properties:

Discipline name:: The name of the _Discipline_ which should be unique.
User name:: Only users logged in with that specified user name will be associated with the _Discipline_.

Disciplines are managed in the _Role Management_.
By default when a new project is created, the _Role Management_ will contain exactly one _Discipline_ called *System*.

In this section you will learn how to:

* Create a new Discipline
* Assign a Discipline to a model element

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open the _Editor_ for the _Role Management_ from the _Navigator_ view by double-clicking menu:MySatellite[Role Management]. 
|image:chapterModeling/OpenRoleManagement.png[Opening the role management editor]

|{counter:step}.
|Press the button *Add Discipline* to insert a new _Discipline_ called _New Discipline_ and that is initially associated with your own user name.

TIP: _Disciplines_ can be removed by selecting a _Discipline_ and then pressing the *Remove Discipline* button.

|image:chapterModeling/AddDiscipline.png[Adding a discpline]

|{counter:step}.
|Select the newly created _Discipline_ in the _Discipline Name_ column and change it to *RepositoryManager*.
Then select the _Discipline_ in the _User Name_ column and change it to *OtherUsername*.

|image:chapterModeling/EditUserName.png[Changing properties of a Discipline]

|{counter:step}.
|We will now assign the discipline to the _Repository_. 
To do this, open the _Repository_ from the _Navigator_.
Then select the combo box listing *Discipline: System* and choose the entry *Discipline: RepositoryManagener*.
Finally press the button *Assign Discipline* button.

TIP: You can assign a _Discipline_ to an element and all sub elements by pressing the *Assign Discipline Recursive* button.

|image:chapterModeling/AssignDiscipline.png[Assigning a Discipline]

|{counter:step}.
|All editable fields will be no longer be editable and shown as greyed out.

WARNING: This includes the _Discipline_ field. 
Once you assign a _Discipline_ only the associated user can return the ownership!

|image:chapterModeling/Uneditable.png[The repository can longer be edited]

|===

TIP: In the event that the rights management needs to be bypassed,
Virtual Satellite can be started with the -superUser flag to gain super user rights.
For further information, check out <<Enforce super user rights>>.

==== Quantities, Units, Dimensions and Values

Values without a physical dimension carry little meaning. 
They need to be considered within their engineering context, 

NOTE: For example the statement "the mass is 5" is ambiguous and not meaningful.
However, the information "the mass is 5kg" is something that can be worked with.

To establish a solid foundation for well-defined and consistent unities,
Virtual Satellite provides an implementation of the Quantities, Units, Dimensions and Values (QUDV).
In this section you will learn how to:

* Create a new _Quantity Kind_
* Create a new _Unit_
* Export a QUDV Model
* Import a QUDV Model

===== Unit Management

The _Unit Management_ is the central hub for managing _Quantity Kinds_ and _Units_.
By default, when you create a new project the _Unit Management_ will be populated by a default QUDV
model supplied by Virtual Satellite.
Further _Quantity Kinds_ and _Units_ required in the project can then be defined.
The QUDV supports two sorts of _Quantity Kinds_:

Simple Quantity Kinds:: A _Simple Quantity Kind_ is not based on another _Quantity Kind_.
+
NOTE: An example for this in the SI unit system is _Mass_.
Derived Quantity Kinds:: A _Derived Quantity Kind_ is defined as a composition of other _Quantity Kinds_. 
Each quantity is equipped with a *factor* stating its involvement.
+
NOTE: An example for this in the SI unit system is _Speed_, 
which is composed over the quantities _Length_ with *factor* of 1 and _Time_ with a *factor* of -1. 

In the same fashion, the Virtual Satellite implementation of QUDV supports the following sorts of _Units_:

Simple Unit:: A _Simple Unit_ is not based on another _Unit_.
+
NOTE: An example for this in the SI unit system is _Second_.
Conversion Based Unit:: A _Conversion Based Unit_ is defined by conversion of a reference _Unit_.
The conversion can be described with a *factor* and an *offset*.
+
NOTE: An example for this in the SI unit system is _Degree Celsius_,
which is defined in reference to _Kelvin_ with a *factor* of 1 and an *offset* of 273.15.
Derived Unit:: A _Derived Unit_ is defined as a composition of other _Units_.
+
NOTE: An example for this in the SI unit system is _Velocity_, 
which is composed of the _Units_ _Metre_ with a *factor* of 1 and _Second_ with a *factor* of -1.
Prefixed Unit:: A _Prefixed Unit_ is defined by a referenced _Unit_ and an added prefix.
+
NOTE: An example for this in the SI unit system is _Milli Second_,
which prefixes the _Unit_ _Second_ with the prefix _Milli_.

In the following you will create a new _Simple Quanitity Kind_ and a new _Simple Unit_ for it.

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open the _Editor_ for the _Unit Management_ from the _Navigator_ view by double-clicking menu:MySatellite[Unit Management]. 
|image:chapterModeling/OpenUnitManagement.png[Opening the unit management editor]

|{counter:step}.
|Scroll to the *Quantity Kind Management* Section and press the *Add Quantity Kind* button. 
|image:chapterModeling/AddQuantityKind.png[Adding a new quantity kind]

|{counter:step}.
|Select the *QUDV Simple Quantity Kind Wizard* option in the *Available wizards* drop-down list.
Then press *Next*. 
|image:chapterModeling/QuantityWizardSelection.png[Selecting the quantity kind wizard]

|{counter:step}.
|Set the name to ´MyQuantityKind´ and fill out the other fields by data of your choosing.
Then press *Finish*. 
You can now find your created _Quantity Kind_ in the *Quantity Kind Management* section.
|image:chapterModeling/SimpleQuantityKindWizard.png[Simple quantity kind wizard]

|{counter:step}.
|Scroll to the *Unit Management* Section and press the *Add Unit* button. 
|image:chapterModeling/AddUnit.png[Adding a unit]

|{counter:step}.
|Select the *QUDV Simple Unit Wizard* option in the *Available wizards* drop-down list.
Then press *Next*. 
|image:chapterModeling/UnitWizardSelection.png[Selecting the quantity kind wizard]

|{counter:step}.
|Set the name to ´MyUnit´ and fill out the other fields by some data.
Then press *Finish*. 
You can now find your created _Unit_ in the *Unit Management* section.
|image:chapterModeling/SimpleUnitWizard.png[Simple unit wizard]

|===

You have created your first own _Unit_ on the basis of your own _Quantity Kind_!
You can remove a created _Quantity Kind_ or _Unit_ by going to the _Unit Management_,
selecting the desired _Quantity Kind_ or _Unit_ then press *Remove Quantity Kind* or *Remove Unit*.
Likewise, editing existing an existing _Quantity Kind_ or _Units_ can be done by pressing *Edit Quantity Kind* or *Edit Unit*.

===== QUDV Wizards

If you have defined a QUDV model to your liking, you can transfer it between different projects
using the QUDV wizards. Virtual Satellite provides an export and an import wizard for QUDV models.
Both wizards can be found in the *VirSat* category.
In the following you will export a QUDV system and re-import it.

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open the _QUDV Export Wizard_ by selecting menu:File[Export] and choosing *QUDV Export Wizard* from the *VirSat* category.
Then select *Next*. 
|image:chapterModeling/QUDVExportWizardSelection.png[Selecting the QUDV export wizard]

|{counter:step}.
|Tick the checkbox for the _Unit Management_ model you wish to export.
Then select an export destination by pressing *Browse*.
Finally press *Finish*. 
|image:chapterModeling/QUDVExportWizard.png[The QUDV export wizard]

|{counter:step}.
|Open the _QUDV Import Wizard_ by selecting menu:File[Import] and choosing *QUDV Import Wizard* from the *VirSat* category.
Then select *Next*. 
|image:chapterModeling/QUDVImportWizardSelection.png[Selecting the QUDV import wizard]

|{counter:step}.
|Select an import destination by pressing *Browse*.
Tick the checkbox for the QUDV model you wish to import.
Then press *Next*. 
|image:chapterModeling/QUDVImportWizard.png[The source selection in the QUDV import wizard]

|{counter:step}.
|Tick the checkbox for the QUDV model you wish to overwrite.
Finally press *Finish*. 
|image:chapterModeling/QUDVImportWizardTargetSelection.png[The target selection in the QUDV import wizard]

|===

=== Modeling Concepts

Virtual Satellite provides an extension mechanism to customize the system modeling to project-specific needs. Concepts allow the creation of new types that can be used in Virtual Satellite models. Virtual Satellite ships basic concepts to a model systems, such as the Concept _de.dlr.sc.virsat.model.extension.ps_. This concept enables to model complex product structures. 

NOTE: To create your own Concepts see Section <<Developing a Concept>>.

==== Activating a Concept

To activate Concepts, it is necessary to have a Virtual Satellite project in the navigator. A new project can be created by clicking the satellite icon in the VirSat Navigator or by right-clicking New > Project then select the folder _VirSat_ and select _VirSat Project_.

Once you have a Virtual Satellite Project (in this documentation called MySatellite) follow the next steps to activate Concepts:

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Open the editor for the _Repository_ from the navigator view by double-clicking menu:MySatellite[Repository]. 
|image:chapterModeling/OpenRepository.png[Opening the repository editor]

|{counter:step}.
|The _Repository Editor_ will open in the _Editing_ area. Scroll down to the _table Section for: Active Concepts_. Here click on btn:[Add from Registry]. 
|image:chapterModeling/RepositoryEditor.png[Select concept to activate]

|{counter:step}.
|Select the Concept to be activated and press the _OK_ button.
|

|===

The concept is now activated.

==== Modeling with the concept palette

After you activated a concept, you can add instances of its elements to the system model. This can be done either with the context menu ( Right-click an element in the navigator, click on the concept name and select the element to be added ) or with the _Concept Palette_ on the right side of the editor.

NOTE: If you try to add an element from the context menu but do not have the rights to add it at the current location (see <<User Rights Management>> ) or the element is not applicable for the current element then the menu is grayed-out.

Follow the next steps to add concept elements from a concept palette:

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Concept elements can be added to the system model by selecting them from the _Concept Palette_. The palette is located right to the editor section.
|image:chapterModeling/ConceptPalette.png[The Concept Palette]

|{counter:step}.
|To select elements from the palette you have to expand the containing concept. To create a basic structure for your system model, you can e.g. expand the _ProductStructure_ concept.
|image:chapterModeling/ConceptPaletteExpanded.png[The ProductStructure section of the Concept Palette]

|{counter:step}.
|From the concept section in the palette you can select concept elements and then *drag* them into the navigator section.
|image:chapterModeling/ConceptPaletteDragElement.png[Drag an element from the palette]

|{counter:step}.
|*Drop* the element at the desired location in the system model. 

NOTE: If you do not have the rights to add the element at the selected location or it is not applicable, then the courser will indicate that.

NOTE: Concepts that are not activated for a project are still shown in the _Concept Palette_, but you cannot add them to the project. The courser will always show that dropping the element is blocked.

|image:chapterModeling/ConceptPaletteDropElement.png[Drop an element in the VirSat Navigator]

|===

==== Extended product structures - Inheritance and Configuration Control

TBD

==== Product mass summaries

TBD

=== Advanced Modeling

TBD

==== Adjusting Equations

Mathematical dependencies between numeric properties are described by _Equations_.
An equation has on the left-hand side a variable and on the right hand-side a mathematical calculation.
Whenever a change in the model occurs, Virtual Satellite re-checks the equations and updates the left-hand side
variable according to the result of the calculation of the right-hand side.
A variable whose value is determined by an equation is a calculated variable.
Such variables are not editable and marked by a calculator symbol image:chapterAdvancedModeling/VirSatCalculated.png[Indication for a variable being calculated by VirSat].

The equations in Virtual Satellite are not hard-coded, but explicit parts of the model.
They can be freely edited using the _Equation Editor_.
In many cases, editing equations is not necessary since a concept may come with its own default equations model.

NOTE: Example Equation: `Ref: massWithMargin = mass * margin;`
Here `massWithMargin` is a calculated variable.
Whenever `mass` or `margin` change, `massWithMargin` is recalculated.

In this section you will learn how to:

* Open the Equation Editor
* Edit an Equation
* Create a new equation

An equation can be defined in the <<Equation Editor>>.
The editor is available in any CategoryAssignment that possesses at least a numeric property.
Every equation follows the format `TYPE: CALCULATED_VARIABLE = CALCULATION;` where

* `TYPE` is either `Ref` or `Calc`. 
`Ref`, short for reference, is used when referencing an element of the data model.
`Calc`, short for intermediate calculation, is used when creating an intermediate variable.
The variable is not part of the data model and thus also not persistently stored.
This type of equation can be used to simplify equations and remove redundant terms.
* `CALCULATED_VARIABLE` is the name of the property that will be calculated.
It is also possible to pass a full qualified name to reference non-local properties.
* `CALCULATION` is a mathematical expression using operators such as `*, +, -, /, sin(...), cos(...)`.
Inputs of a calculation are other properties, specified by their name.
It is also possible to pass full qualified names to reference non-local properties.

Concepts may also provide customized extensions for the calculation engine.
This includes allowing the use of other objects than properties for input and outputs,
defining new mathematical functions, and so on.

===== Equation Editor

The Equation Editor is a textual editor and the main tool for editing equations.
In the following, we will modify the equations of the <<Product mass summaries>> concept 
to include an additional top-level system margin.
You will need a VirSat project (called MySatellite in the following) with the 
<<Extended product structures - Inheritance and Configuration Control>> concept and the 
<<Product mass summaries>> concept both activated.

:step: 0
[%header,cols=">8,62a,40a"] 
|===

|Step
|Task
|Image

|{counter:step}.
|Create a data model consisting of a ConfigurationTree as the root with two child ElementConfigurations.
Attach a MassEquipment to each ElementConfiguration and a MassSummary to the ConfigurationTree. 
|image:chapterAdvancedModeling/EquationEditorDataModel.png[Setting up a data model with equations]

|{counter:step}.
|Set the mass value of the first ElementConfiguration to 10 and the mass value of the second ElementConfiguration to 15.
Leave the margins at 20.
|image:chapterAdvancedModeling/EquationEditorDataModelValues.png[Setting input values for equations]

|{counter:step}.
|Save (kbd:[CTRL+S]) and then open the Editor of the MassSummary of ConfigurationTree.
The massWithMargin value should show 30.
Next open the EquationEditor by pressing the Edit Equations button.
|image:chapterAdvancedModeling/EquationEditorOpen.png[Opening the equation editor]

|{counter:step}.
|Create a new equation `Calc: systemMargin = 0.1`. This creates a new intermediate variable called systemMargin with value 0.1.
Modify the equation of  massWithMargin by adding the factor  `(1 + systemMargin)`.
After saving (kbd:[CTRL+S]) the value of massWithMargin should update to 33.

TIP: You can also delete equations by removing them in the Equation Editor.
This way you can manually override any calculated values.

|image:chapterAdvancedModeling/EquationEditorEditingEquations.png[Editing equations]

|===

===== Aggregation Functions 

In addition to the usual mathematical functions with fixed number of inputs, Virtual Satellite supports _aggregation functions_.
Aggregation functions are intended to apply operations such as summing up all elements, calculating the mean, etc. on a set of inputs.
The input set can be specified either by explicitly listing all inputs or an input type.

NOTE: An example use of an aggregation function is the expression `summary(AMassParameters.massWithMargins)` 
from the <<Product mass summaries>> concept, which sums up all massWithMargin values of categories of type AMassParameter. 

Calling an aggregation function on N specific number of instances can be achieved via the following syntax:

....
aggregationFunction { propertyInstanceName1, ..., propertyInstanceNameN }
....

Alternatively, calling an aggregation function on a instance type achieved via the syntax

....
aggregationFunction(propertyName, nameFilter, depth)
....

where

* *nameFilter* is optional and filters out all Categories that do not confirm to the nameFilter
* *depth* is optional and limits the aggregation depth. The value -1 represents limitless aggregation and is set by default.

Concepts may define new aggregation functions as necessary and may also allow other objects than properties to be used
as aggregation inputs. By default Virtual Satellite CORE comes with a set of aggregation functions, namely:

summary:: `summary` sums up all elements in the set. Returns 0 for empty sets.
mean:: `mean` computes the average over the set. Returns NaN for empty set.
Max:: `max` computes the maximum value over the set. Returns NaN for empty sets.
Min:: `min` computes the minimum value over the set. Returns NaN for empty sets.
Count:: `count` counts the number of elements in the set. Returns 0 for empty sets.

===== Calculation Builder

The automatic calculation updates are performed via the _Calculation Builder_. 
The builder executes by default whenever there is a change in the data model.
Should it be desired for the builder to not execute automatically, it can be turned off
by toggling the option menu:Project[Build Automatically].
In the same menue, manual builds can also be triggered via menu:Project[Build All].

Just like all other data model changes, the builder is subject to the rights management.
Should a value be updated and a calculated variable require an update, which cannot
be performed due to lack of rights, a `Computed value is out of date` warning is issued instead.
A proposed update order for to resolve these warnings can be obtained from the _Domain Round View_.
The view can be opened via menu:Window[Show View > Other > VirSat > Domain Round].
By selecting a project in the _Navigator_, the view will then show a proposed update order to resolve calculation dependencies.

==== Using Apps

TBD

==== Developing a Concept

TBD

== Advanced Functionality

TBD

=== Enforce user rights

TBD

=== Enforce super user rights

TBD

=== Equinox OSGI Console

TBD

[colophone]
== License & Copyright

|===
| Product Version:      | {revnumber}
| Build Date Qualifier: | {revdate}
| Travis CI Job Number: | {buildnr}
|=== 

Copyright (c) 2008-2019 DLR (German Aerospace Center),
Simulation and Software Technology.
Lilienthalplatz 7, 38108 Braunschweig, Germany

This program and the accompanying materials are made available under the terms of the Eclipse Public License 2.0 which is available at https://www.eclipse.org/legal/epl-2.0/ . A copy of the license is shipped with the Virtual Satellite software product.
